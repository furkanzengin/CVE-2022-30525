# CVE-2022-30525
A OS Command Injection Vulnerability in the CGI Program of Zyxel

# Introduction
On April 13, 2022, Rapid7 reported a vulnerability that affects Zyxel firewall devices, allowing attackers to inject arbitrary commands remotely as a "nobody" user without authentication. This vulnerability was handled at a critical level and the CVSS score was determined as 9.8. Zyxel then addressed the vulnerability by issuing a security update on April 28, 2022. On May 12, 2022, Rapid7 published an advisory and Metasploit module for this vulnerability.

# Vulnerability with Its Impact
Researchers at ShadowServer have begun to monitor attempts to exploit CVE-2022-30525. At least 20.800 of the affected Zyxel firewall models have been exposed online during the investigations. It was noted that most of the affected models were in France and Italy. 

![alt text](https://pbs.twimg.com/media/FSygypUXsAUwkou.jpg:large)

The vulnerability stems from the use of “os.system” with attacker-provided data. The /ztp/cgi-bin/handler endpoint is used to launch the attack. Handler is a Python script that can execute a number of different commands. Jake Baines, who first reported the error, explained the vulnerability in his blog as follows: “Rapid7 discovered and reported a vulnerability that affects Zyxel firewalls supporting Zero Touch Provisioning (ZTP), which includes the ATP series, VPN series, and the USG FLEX series (including USG20-VPN and USG20W-VPN). The vulnerability, identified as CVE-2022-30525, allows an unauthenticated and remote attacker to achieve arbitrary code execution as the nobody user on the affected device.”
The problem arises from a command called "setWanPortSt" within the zero touch provisioning implementation, which allows the remote provision to change the IP settings of the firewall's ports.

# Exploitation
A PoC has been published to better understand how exploitation is done. Victorian Machinery is a proof of concept exploit for CVE-2022-30525. The vulnerability is an unauthenticated and remote command injection vulnerability affecting Zyxel firewall's that support zero touch provisioning. 
